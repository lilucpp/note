# 模式扩展

### 1. 简介

Shell 接收到用户输入的命令以后，会根据空格将用户的输入，拆分成一个个词元（token）。然后，Shell 会扩展词元里面的特殊字符，扩展完成后才会调用相应的命令。  

这种特殊字符的扩展，称为模式扩展（globbing）。其中有些用到通配符，又称为通配符扩展（wildcard expansion）。Bash 一共提供八种扩展。

- 波浪线扩展
- `?` 字符扩展
- `*` 字符扩展
- 方括号扩展
- 大括号扩展
- 变量扩展
- 子命令扩展
- 算术扩展

Bash 是先进行扩展，再执行命令。因此，扩展的结果是由 Bash 负责的，与所要执行的命令无关。命令本身并不存在参数扩展，收到什么参数就原样执行。这一点务必需要记住。  

模式扩展与正则表达式的关系是，模式扩展早于正则表达式出现，可以看作是原始的正则表达式。它的功能没有正则那么强大灵活，但是优点是简单和方便。  

Bash 允许用户关闭扩展。  

```
$ set -o noglob
# 或者
$ set -f
```

下面的命令可以重新打开扩展。

```
$ set +o noglob
# 或者
$ set +f
```

### 2. 波浪线扩展

波浪线`~`会自动扩展成当前用户的主目录。

## 3. `?` 字符扩展

`?`字符代表文件路径里面的任意单个字符，不包括空字符（？？）。比如，`Data???`匹配所有`Data`后面跟着三个字符的文件名。

### 4. `*` 字符扩展

`*`字符代表文件路径里面的任意数量的任意字符，包括零个字符。  

注意，`*`不会匹配隐藏文件（以`.`开头的文件），即`ls *`不会输出隐藏文件。  

如果要匹配隐藏文件，需要写成`.*`。  

## 5. 方括号扩展

方括号扩展的形式是`[...]`，只有文件确实存在的前提下才会扩展。如果文件不存在，就会原样输出。括号之中的任意一个字符。

```
# 存在文件 a.txt 和 b.txt
$ ls [ab].txt
a.txt b.txt

# 只存在文件 a.txt
$ ls [ab].txt
a.txt
```

方括号扩展还有两种变体：`[^...]`和`[!...]`。它们表示匹配不在方括号里面的字符，这两种写法是等价的。比如，`[^abc]`或`[!abc]`表示匹配除了`a`、`b`、`c`以外的字符。

```
# 存在 aaa、bbb、aba 三个文件
$ ls ?[!a]?
aba bbb
```

### 6. [start-end] 扩展

方括号扩展有一个简写形式`[start-end]`，表示匹配一个连续的范围。  

- `[a-z]`：所有小写字母。
- `[a-zA-Z]`：所有小写字母与大写字母。
- `[a-zA-Z0-9]`：所有小写字母、大写字母与数字。

这种简写形式有一个否定形式`[!start-end]`，表示匹配不属于这个范围的字符。比如，`[!a-zA-Z]`表示匹配非英文字母的字符。  

### 7. 大括号扩展

大括号扩展`{...}`表示分别扩展成大括号里面的所有值，各个值之间使用逗号分隔。比如，`{1,2,3}`扩展成`1 2 3`。  

逗号前面可以没有值，表示扩展的第一项为空。

```
$ cp a.log{,.bak}

# 等同于
# cp a.log a.log.bak
```

大括号可以嵌套。也可以与其他模式联用。

```txt
echo /bin/{cat,b*}
/bin/cat /bin/b2sum /bin/base32 ...
```

大括号不是文件名扩展，所以总是会扩展。

```txt
# 不存在a.txt b.txt
echo [ab].txt
[ab].txt

echo {a,b}.txt
a.txt b.txt
```

### 8. {start..end} 扩展

扩展成一个序列，支持逆序，也支持{start..end..step}。

```txt
echo {2..10..3}
2 5 8
```

也可以连用。

```txt
echo {a..c}{1..3}
a1 a2 a3 b1 b2 b3 c1 c2 c3
```

### 9. 变量扩展

```txt
echo $SHELL
echo ${SHELL}
```

### 10. 子命令扩展

```txt
echo $(date)
2022年 08月 11日 星期四 16:47:26 CST

```

### 11. 算术扩展

```txt
echo $((2+2))
4
```

### 12. 量词语法

```txt
?(): 0or1
*(): 0 or oo
+(): 1 or 1+
!(): 匹配给定外的内容。
```









